{"version":3,"file":"auth-legacy-BHQlUcIz.js","sources":["../../gradepad/jsScripts/db.js","../../gradepad/jsScripts/errorHandler.js","../../gradepad/jsScripts/firebase.js","../../gradepad/jsScripts/gradeCalc.js","../../gradepad/jsScripts/dragDrop.js","../../gradepad/jsScripts/utils.js","../../gradepad/jsScripts/modal.js","../../gradepad/jsScripts/tableOps.js","../../gradepad/jsScripts/main.js","../../gradepad/jsScripts/theme.js","../../gradepad/jsScripts/auth.js"],"sourcesContent":["import { db } from \"./firebase.js\";\r\nimport { auth } from \"./firebase.js\";\r\nimport {\r\n  collection as firestoreCollection,\r\n  addDoc,\r\n  doc,\r\n  setDoc,\r\n  collection,\r\n  getDocs,\r\n  deleteDoc,\r\n  serverTimestamp\r\n} from \"https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js\";\r\n\r\n\r\n\r\n// --- Save Semester (with generated ID you can use later) ---\r\nexport async function saveSemester({ name, startDate, endDate, semesterId = null }) {\r\n  const user = auth.currentUser;\r\n  if (!user) {\r\n    console.error(\"‚ùå No user is logged in.\");\r\n    return null;\r\n  }\r\n\r\n  try {\r\n    const semesterRef = semesterId\r\n      ? doc(db, \"users\", user.uid, \"semesters\", semesterId)\r\n      : doc(collection(db, \"users\", user.uid, \"semesters\"));\r\n\r\n    await setDoc(semesterRef, {\r\n      name,\r\n      startDate,\r\n      endDate,\r\n      createdAt: new Date()\r\n    });\r\n\r\n    console.log(semesterId ? \"‚úèÔ∏è Semester updated:\" : \"‚úÖ Semester saved:\", semesterRef.id);\r\n    return semesterRef.id;\r\n  } catch (error) {\r\n    console.error(\"‚ùå Failed to save/update semester:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n\r\n\r\n// --- Load Semesters ---\r\nexport async function loadSemesters() {\r\n  const user = auth.currentUser;\r\n\r\n  if (!user) {\r\n    console.error(\"‚ùå No user is logged in.\");\r\n    return [];\r\n  }\r\n\r\n  try {\r\n    const querySnapshot = await getDocs(\r\n      firestoreCollection(db, \"users\", user.uid, \"semesters\")\r\n    );\r\n    const semesters = [];\r\n    querySnapshot.forEach((doc) => {\r\n      semesters.push({ id: doc.id, ...doc.data() });\r\n    });\r\n    console.log(\"‚úÖ Loaded semesters:\", semesters);\r\n    return semesters;\r\n  } catch (error) {\r\n    console.error(\"‚ùå Failed to load semesters:\", error);\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function saveCourse({ semesterId, code, topic, units }) {\r\n  const user = auth.currentUser;\r\n  if (!user || !semesterId) return;\r\n\r\n  try {\r\n    const courseRef = await addDoc(\r\n      collection(db, \"users\", user.uid, \"semesters\", semesterId, \"courses\"),\r\n      {\r\n        code,\r\n        topic,\r\n        units,\r\n        createdAt: new Date()\r\n      }\r\n    );\r\n    console.log(`‚úÖ Course \"${code}\" saved under semester ${semesterId}`);\r\n    return courseRef.id;\r\n  } catch (err) {\r\n    console.error(\"‚ùå Failed to save course:\", err);\r\n  }\r\n}\r\n\r\nexport async function saveEvaluation({ semesterId, courseId, name, due, grade, weight, index }) {\r\n  try {\r\n    const evaluationRef = collection(db, \"users\", auth.currentUser.uid, \"semesters\", semesterId, \"courses\", courseId, \"evaluations\");\r\n\r\n    const evaluationData = {\r\n      name: name ?? \"\",\r\n      due: due ?? \"\",\r\n      grade: grade ?? \"\",\r\n      weight: weight ?? \"\",\r\n      index: index ?? 0, // ‚úÖ fallback index\r\n      createdAt: serverTimestamp(),\r\n    };\r\n\r\n    await addDoc(evaluationRef, evaluationData);\r\n    console.log(\"‚úÖ Evaluation saved:\", evaluationData);\r\n  } catch (error) {\r\n    console.error(\"‚ùå Error saving evaluation:\", error);\r\n  }\r\n}\r\n\r\n\r\n\r\nexport async function loadCourses(semesterId) {\r\n  const user = auth.currentUser;\r\n  if (!user || !semesterId) return [];\r\n\r\n  const courses = [];\r\n  const courseSnap = await getDocs(\r\n    collection(db, \"users\", user.uid, \"semesters\", semesterId, \"courses\")\r\n  );\r\n\r\n  for (const courseDoc of courseSnap.docs) {\r\n    const courseId = courseDoc.id;\r\n    const courseData = courseDoc.data();\r\n\r\n    const evalSnap = await getDocs(\r\n      collection(db, \"users\", user.uid, \"semesters\", semesterId, \"courses\", courseId, \"evaluations\")\r\n    );\r\n\r\n    const seen = new Set();\r\n    const evaluations = evalSnap.docs\r\n      .map((d) => d.data())\r\n      .filter((e) => {\r\n        const key = `${e.index}-${e.name}-${e.due}-${e.grade}-${e.weight}`;\r\n        if (seen.has(key)) return false;\r\n        seen.add(key);\r\n        return true;\r\n      })\r\n      .sort((a, b) => (a.index ?? 0) - (b.index ?? 0));\r\n\r\n\r\n    courses.push({\r\n      id: courseId,\r\n      ...courseData,\r\n      evaluations\r\n    });\r\n  }\r\n\r\n  return courses;\r\n}\r\n\r\n\r\nexport async function deleteCourse(semesterId, courseId) {\r\n  const user = auth.currentUser;\r\n  if (!user || !semesterId || !courseId) {\r\n    console.warn(\"‚ö†Ô∏è Missing user, semesterId, or courseId\", { user, semesterId, courseId });\r\n    return;\r\n  }\r\n\r\n  console.log(\"üóëÔ∏è Attempting to delete course:\", courseId, \"from semester:\", semesterId);\r\n\r\n  try {\r\n    await deleteDoc(doc(db, \"users\", user.uid, \"semesters\", semesterId, \"courses\", courseId));\r\n    console.log(\"‚úÖ Course deleted from Firestore:\", courseId);\r\n  } catch (err) {\r\n    console.error(\"‚ùå Failed to delete course:\", err);\r\n  }\r\n}\r\n\r\n\r\nexport async function deleteSemester(semesterId) {\r\n  const user = auth.currentUser;\r\n  console.log(\"üß† Deleting semester:\", semesterId);\r\n\r\n  if (!user || !semesterId) {\r\n    console.warn(\"‚ö†Ô∏è Missing user or semesterId\", { user, semesterId });\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const coursesRef = collection(db, \"users\", user.uid, \"semesters\", semesterId, \"courses\");\r\n    const courseSnapshot = await getDocs(coursesRef);\r\n\r\n    for (const courseDoc of courseSnapshot.docs) {\r\n      const courseId = courseDoc.id;\r\n\r\n      // Delete evaluations under the course\r\n      const evalsRef = collection(db, \"users\", user.uid, \"semesters\", semesterId, \"courses\", courseId, \"evaluations\");\r\n      const evalSnapshot = await getDocs(evalsRef);\r\n\r\n      for (const evalDoc of evalSnapshot.docs) {\r\n        await deleteDoc(evalDoc.ref);\r\n        console.log(`üóëÔ∏è Deleted evaluation ${evalDoc.id}`);\r\n      }\r\n\r\n      // Delete the course itself\r\n      await deleteDoc(courseDoc.ref);\r\n      console.log(`üóëÔ∏è Deleted course ${courseId}`);\r\n    }\r\n\r\n    // Finally delete the semester\r\n    await deleteDoc(doc(db, \"users\", user.uid, \"semesters\", semesterId));\r\n    console.log(`üóëÔ∏è Deleted semester ${semesterId} from Firestore`);\r\n  } catch (err) {\r\n    console.error(\"‚ùå Failed to fully delete semester and contents:\", err);\r\n  }\r\n}\r\n\r\n\r\nexport async function clearEvaluations(semesterId, courseId) {\r\n  const user = auth.currentUser;\r\n  if (!user) return;\r\n\r\n  const evalsRef = collection(db, \"users\", user.uid, \"semesters\", semesterId, \"courses\", courseId, \"evaluations\");\r\n  const snapshot = await getDocs(evalsRef);\r\n  const deletions = snapshot.docs.map((doc) => deleteDoc(doc.ref));\r\n  await Promise.all(deletions);\r\n  console.log(\"üßπ Cleared evaluations for course\", courseId);\r\n}\r\n\r\n","// Enhanced Error Handling for GradePad\r\nclass ErrorHandler {\r\n  constructor() {\r\n    this.setupGlobalErrorHandling();\r\n    this.setupUnhandledRejections();\r\n  }\r\n\r\n  setupGlobalErrorHandling() {\r\n    window.addEventListener('error', (event) => {\r\n      console.error('üö® Global Error:', event.error);\r\n      this.showUserFriendlyError('Something went wrong. Please try again.');\r\n    });\r\n  }\r\n\r\n  setupUnhandledRejections() {\r\n    window.addEventListener('unhandledrejection', (event) => {\r\n      console.error('üö® Unhandled Promise Rejection:', event.reason);\r\n      this.showUserFriendlyError('A network error occurred. Please check your connection.');\r\n      event.preventDefault(); // Prevent default browser error handling\r\n    });\r\n  }\r\n\r\n  showUserFriendlyError(message, type = 'error') {\r\n    // Remove existing notifications\r\n    const existingNotification = document.getElementById('error-notification');\r\n    if (existingNotification) {\r\n      existingNotification.remove();\r\n    }\r\n\r\n    const notification = document.createElement('div');\r\n    notification.id = 'error-notification';\r\n    notification.innerHTML = `\r\n      <div style=\"display: flex; justify-content: space-between; align-items: center;\">\r\n        <span>${type === 'error' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è'} ${message}</span>\r\n        <button onclick=\"this.parentElement.parentElement.remove()\" style=\"background: none; border: none; color: white; font-size: 18px; cursor: pointer;\">\r\n          √ó\r\n        </button>\r\n      </div>\r\n    `;\r\n    \r\n    const backgroundColor = type === 'error' ? '#f44336' : '#2196F3';\r\n    \r\n    notification.style.cssText = `\r\n      position: fixed;\r\n      top: 20px;\r\n      right: 20px;\r\n      background: ${backgroundColor};\r\n      color: white;\r\n      padding: 16px 20px;\r\n      border-radius: 8px;\r\n      font-size: 14px;\r\n      z-index: 1002;\r\n      box-shadow: 0 4px 12px rgba(0,0,0,0.2);\r\n      max-width: 400px;\r\n      animation: slideIn 0.3s ease-out;\r\n    `;\r\n\r\n    // Add animation styles\r\n    const style = document.createElement('style');\r\n    style.textContent = `\r\n      @keyframes slideIn {\r\n        from { transform: translateX(100%); opacity: 0; }\r\n        to { transform: translateX(0); opacity: 1; }\r\n      }\r\n    `;\r\n    document.head.appendChild(style);\r\n\r\n    document.body.appendChild(notification);\r\n\r\n    // Auto-remove after 5 seconds\r\n    setTimeout(() => {\r\n      if (notification.parentElement) {\r\n        notification.remove();\r\n      }\r\n    }, 5000);\r\n  }\r\n\r\n  // Firebase-specific error handling\r\n  handleFirebaseError(error, context = '') {\r\n    console.error(`üî• Firebase Error ${context}:`, error);\r\n    \r\n    let userMessage = 'A database error occurred.';\r\n    \r\n    switch (error.code) {\r\n      case 'permission-denied':\r\n        userMessage = 'You don\\'t have permission to perform this action.';\r\n        break;\r\n      case 'unavailable':\r\n        userMessage = 'Database is temporarily unavailable. Please try again.';\r\n        break;\r\n      case 'unauthenticated':\r\n        userMessage = 'Please sign in to continue.';\r\n        break;\r\n      case 'network-request-failed':\r\n        userMessage = 'Network error. Please check your connection.';\r\n        break;\r\n      default:\r\n        userMessage = `Database error: ${error.message}`;\r\n    }\r\n    \r\n    this.showUserFriendlyError(userMessage);\r\n    return userMessage;\r\n  }\r\n\r\n  // Form validation error handling\r\n  handleValidationError(field, message) {\r\n    const input = document.querySelector(`[name=\"${field}\"], #${field}`);\r\n    if (input) {\r\n      input.style.borderColor = '#f44336';\r\n      input.focus();\r\n      \r\n      // Remove error styling after user starts typing\r\n      input.addEventListener('input', () => {\r\n        input.style.borderColor = '';\r\n      }, { once: true });\r\n    }\r\n    \r\n    this.showUserFriendlyError(message);\r\n  }\r\n\r\n  // Success notification\r\n  showSuccess(message) {\r\n    this.showUserFriendlyError(message, 'success');\r\n  }\r\n}\r\n\r\n// Create global error handler instance\r\nwindow.errorHandler = new ErrorHandler();\r\n\r\n// Export for module usage\r\nexport default window.errorHandler;\r\n","import { initializeApp } from \"https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js\";\r\nimport { getAuth } from \"https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js\";\r\nimport { getFirestore } from \"https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js\";\r\nimport errorHandler from './errorHandler.js';\r\n\r\n// Validate environment variables\r\nconst requiredEnvVars = [\r\n  'VITE_FIREBASE_API_KEY',\r\n  'VITE_FIREBASE_AUTH_DOMAIN', \r\n  'VITE_FIREBASE_PROJECT_ID',\r\n  'VITE_FIREBASE_STORAGE_BUCKET',\r\n  'VITE_FIREBASE_MESSAGING_SENDER_ID',\r\n  'VITE_FIREBASE_APP_ID'\r\n];\r\n\r\nconst missingVars = requiredEnvVars.filter(varName => !import.meta.env[varName]);\r\nif (missingVars.length > 0) {\r\n  console.error('‚ùå Missing Firebase environment variables:', missingVars);\r\n  errorHandler.showUserFriendlyError('Firebase configuration error. Please check your environment variables.');\r\n}\r\n\r\nconst firebaseConfig = {\r\n  apiKey: import.meta.env.VITE_FIREBASE_API_KEY,\r\n  authDomain: import.meta.env.VITE_FIREBASE_AUTH_DOMAIN,\r\n  projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,\r\n  storageBucket: import.meta.env.VITE_FIREBASE_STORAGE_BUCKET,\r\n  messagingSenderId: import.meta.env.VITE_FIREBASE_MESSAGING_SENDER_ID,\r\n  appId: import.meta.env.VITE_FIREBASE_APP_ID,\r\n  measurementId: import.meta.env.VITE_FIREBASE_MEASUREMENT_ID\r\n};\r\n\r\nlet app, auth, db;\r\n\r\ntry {\r\n  app = initializeApp(firebaseConfig);\r\n  auth = getAuth(app);\r\n  db = getFirestore(app);\r\n  \r\n  console.log('‚úÖ Firebase initialized successfully');\r\n} catch (error) {\r\n  console.error('‚ùå Firebase initialization failed:', error);\r\n  errorHandler.handleFirebaseError(error, 'Initialization');\r\n  throw error;\r\n}\r\n\r\nexport { auth, db };\r\n","export function calculateFinalGrade(event) {\r\n    const table = event?.target?.closest?.(\"table\") || event;\r\n    if (!table) return;\r\n  \r\n    const rows = table.querySelectorAll(\"tr:not(:first-child, #finalGradeRow)\");\r\n    let totalWeightedScore = 0;\r\n    let totalWeight = 0;\r\n    let validInput = false;\r\n  \r\n    rows.forEach((row) => {\r\n      const gradeInput = row.querySelector(\".gradeInput\");\r\n      const weightInput = row.querySelector(\".weightInput\");\r\n      const lostOutput = row.querySelector(\".lostOutput\");\r\n  \r\n      if (!gradeInput || !weightInput || !lostOutput) return;\r\n  \r\n      let grade = parseFloat(gradeInput.value);\r\n      let weight = parseFloat(weightInput.value);\r\n  \r\n      if (!isNaN(grade) && !isNaN(weight) && weight > 0) {\r\n        totalWeightedScore += grade * weight;\r\n        totalWeight += weight;\r\n        validInput = true;\r\n  \r\n        let lostValue = ((grade - 100) / 100) * weight;\r\n        lostOutput.innerText = `${lostValue > 0 ? \"+\" : \"\"}${lostValue.toFixed(2)}%`;\r\n        lostOutput.style.color =\r\n          lostValue > 0 ? \"#6aa84f\" : lostValue < 0 ? \"#cc0000\" : \"black\";\r\n      } else {\r\n        lostOutput.innerText = \"‚Äî\";\r\n        lostOutput.style.color = \"black\";\r\n      }\r\n    });\r\n  \r\n    const finalGradeCell = table.querySelector(\".finalGrade\");\r\n    if (!finalGradeCell) return;\r\n  \r\n    if (!validInput) {\r\n      finalGradeCell.innerText = \"Pending\";\r\n      finalGradeCell.style.color = \"black\";\r\n    } else {\r\n      let finalGrade = totalWeight > 0 ? totalWeightedScore / totalWeight : 0;\r\n      finalGradeCell.innerText = `${finalGrade.toFixed(2)}%`;\r\n      finalGradeCell.style.color =\r\n        finalGrade >= 80 ? \"#6aa84f\" : finalGrade >= 50 ? \"#E65100\" : \"#cc0000\";\r\n    }\r\n  \r\n    calculateCurrentGPA();\r\n  }\r\n  \r\n  export function calculateCurrentGPA() {\r\n    const tables = document.querySelectorAll(\".table-wrapper table\");\r\n    let weightedGradeSum = 0;\r\n    let totalUnits = 0;\r\n  \r\n    tables.forEach((table) => {\r\n      const finalGradeCell = table.querySelector(\".finalGrade\");\r\n      const unitsDropdown = table.querySelector(\".courseUnitsDropdown\");\r\n  \r\n      if (\r\n        finalGradeCell &&\r\n        finalGradeCell.textContent !== \"Pending\" &&\r\n        unitsDropdown\r\n      ) {\r\n        const grade = parseFloat(finalGradeCell.textContent);\r\n        const units = parseFloat(unitsDropdown.value);\r\n  \r\n        if (!isNaN(grade) && !isNaN(units)) {\r\n          weightedGradeSum += grade * units;\r\n          totalUnits += units;\r\n        }\r\n      }\r\n    });\r\n  \r\n    const average =\r\n      totalUnits > 0 ? (weightedGradeSum / totalUnits).toFixed(2) : \"0.00\";\r\n    document.getElementById(\"current-gpa\").textContent = `Term GPA: ${average}`;\r\n  }\r\n  ","function isAllowedRow(row) {\r\n    return !(row.querySelector(\".courseCode\") || row.classList.contains(\"columnTitles\") || row.id === \"finalGradeRow\");\r\n  }\r\n  \r\n  function getAllowedSibling(row, direction) {\r\n    let sibling = direction === \"prev\" ? row.previousElementSibling : row.nextElementSibling;\r\n    while (sibling) {\r\n      if (isAllowedRow(sibling)) return sibling;\r\n      sibling = direction === \"prev\" ? sibling.previousElementSibling : sibling.nextElementSibling;\r\n    }\r\n    return null;\r\n  }\r\n  \r\n  export function setupMoveRowButton(button) {\r\n    button.addEventListener(\"mousedown\", function (e) {\r\n      e.preventDefault();\r\n      isDragging = true;\r\n      draggedRow = e.target.closest(\"tr\");\r\n      initialY = e.clientY;\r\n  \r\n      const tbody = draggedRow.parentNode;\r\n      const allowedRows = Array.from(tbody.querySelectorAll(\"tr\")).filter(isAllowedRow);\r\n      originalIndex = allowedRows.indexOf(draggedRow);\r\n      draggedRow.classList.add(\"dragging\");\r\n    });\r\n  }\r\n  \r\n  function handleMouseMove(e) {\r\n    if (!isDragging || !draggedRow) return;\r\n    const deltaY = e.clientY - initialY;\r\n    draggedRow.style.transform = `translateY(${deltaY}px)`;\r\n  \r\n    const tbody = draggedRow.parentNode;\r\n    const prevRow = getAllowedSibling(draggedRow, \"prev\");\r\n    const nextRow = getAllowedSibling(draggedRow, \"next\");\r\n  \r\n    if (prevRow) {\r\n      const rect = prevRow.getBoundingClientRect();\r\n      if (e.clientY < rect.top + rect.height / 2) {\r\n        draggedRow.style.transform = \"\";\r\n        requestAnimationFrame(() => tbody.insertBefore(draggedRow, prevRow));\r\n        initialY = e.clientY;\r\n      }\r\n    }\r\n  \r\n    if (nextRow) {\r\n      const rect = nextRow.getBoundingClientRect();\r\n      if (e.clientY > rect.top + rect.height / 2) {\r\n        draggedRow.style.transform = \"\";\r\n        requestAnimationFrame(() => tbody.insertBefore(draggedRow, nextRow.nextElementSibling));\r\n        initialY = e.clientY;\r\n      }\r\n    }\r\n  }\r\n  \r\n  function handleMouseUp() {\r\n    if (isDragging && draggedRow) {\r\n      draggedRow.style.transform = \"\";\r\n      draggedRow.classList.remove(\"dragging\");\r\n    }\r\n    isDragging = false;\r\n    draggedRow = null;\r\n  }\r\n  \r\n  // Global state\r\n  let isDragging = false;\r\n  let draggedRow = null;\r\n  let initialY = 0;\r\n  let originalIndex = -1;\r\n  \r\n  document.addEventListener(\"mousemove\", handleMouseMove);\r\n  document.addEventListener(\"mouseup\", handleMouseUp);\r\n  ","export function toggleNav() {\r\n    const sidenav = document.getElementById(\"mySidenav\");\r\n    const menuIcon = document.getElementById(\"menuIcon\");\r\n  \r\n    if (window.getComputedStyle(sidenav).width === \"250px\") {\r\n      sidenav.style.width = \"0px\";\r\n      menuIcon.innerHTML = \"&#9776;\";\r\n      menuIcon.classList.remove(\"open\");\r\n    } else {\r\n      sidenav.style.width = \"250px\";\r\n      menuIcon.innerHTML = \"&times;\";\r\n      menuIcon.classList.add(\"open\");\r\n    }\r\n  }\r\n  \r\n  export function toggleCollapse(event) {\r\n    const collapseButton = event.target;\r\n    const tableWrapper = collapseButton.closest(\".table-wrapper\");\r\n    const table = tableWrapper?.querySelector(\"table\");\r\n    const deleteButton = table.querySelector(\".deleteButton\");\r\n    const finalGradeRow = table.querySelector(\"#finalGradeRow\");\r\n  \r\n    if (!table || !finalGradeRow) return;\r\n  \r\n    const finalMarkLabel = finalGradeRow.children[0];\r\n    const finalMarkValue = finalGradeRow.children[1];\r\n    const unitsCell = finalGradeRow.children[2];\r\n  \r\n    const isCollapsed = table.classList.toggle(\"collapsed\");\r\n    deleteButton.style.display = isCollapsed ? \"none\" : \"inline-block\";\r\n  \r\n    const syllabusButton = table.querySelector(\".syllabusButton\");\r\n    if (syllabusButton) {\r\n      syllabusButton.style.display = isCollapsed ? \"none\" : \"inline-block\";\r\n    }\r\n  \r\n    const courseUnitsDropdown = table.querySelector(\".courseUnitsDropdown\");\r\n    if (courseUnitsDropdown) {\r\n      courseUnitsDropdown.style.display = isCollapsed ? \"none\" : \"inline-block\";\r\n    }\r\n  \r\n    finalMarkLabel.setAttribute(\"colspan\", isCollapsed ? \"1\" : \"2\");\r\n    finalMarkValue.setAttribute(\"colspan\", isCollapsed ? \"1\" : \"2\");\r\n    if (unitsCell) unitsCell.style.display = isCollapsed ? \"none\" : \"table-cell\";\r\n  \r\n    collapseButton.innerText = isCollapsed ? \"‚õ∂\" : \"‚Üê\";\r\n  }\r\n  ","import { saveSemester } from './db.js';\r\nimport { deleteSemester } from './db.js';\r\nimport { addRow, removeRow, attachEventListeners } from './tableOps.js';\r\nimport { setupMoveRowButton } from './dragDrop.js';\r\nimport { calculateFinalGrade } from './gradeCalc.js';\r\n\r\nlet editingSemesterCard = null;\r\n\r\nfunction convertToISO(dateStr) {\r\n  const parsed = new Date(dateStr);\r\n  return isNaN(parsed) ? \"\" : parsed.toISOString().split(\"T\")[0];\r\n}\r\n\r\nfunction formatAsLocalDate(inputDateStr) {\r\n  const [year, month, day] = inputDateStr.split(\"-\");\r\n  return `${parseInt(month)}/${parseInt(day)}/${year}`;\r\n}\r\n\r\nexport function setupSettingsModal() {\r\n  const settingsModal = document.getElementById(\"settingsModal\");\r\n  const settingsBtn = document.getElementById(\"settingsIcon\");\r\n  const settingsClose = settingsModal?.querySelector(\".close\");\r\n\r\n  if (settingsBtn && settingsModal && settingsClose) {\r\n    settingsBtn.onclick = () => settingsModal.classList.add(\"active\");\r\n    settingsClose.onclick = () => settingsModal.classList.remove(\"active\");\r\n    window.addEventListener(\"click\", (e) => {\r\n      if (e.target === settingsModal) settingsModal.classList.remove(\"active\");\r\n    });\r\n  }\r\n}\r\n\r\nexport function setupSemesterModal() {\r\n  const semesterModal = document.getElementById(\"addSemesterModal\");\r\n  const semesterBtn = document.getElementById(\"addSemester\");\r\n  const semesterClose = semesterModal?.querySelector(\".close\");\r\n  const saveBtn = document.getElementById(\"saveSemester\");\r\n\r\n  if (semesterBtn && semesterModal && semesterClose) {\r\n    semesterBtn.onclick = () => {\r\n      editingSemesterCard = null;\r\n      document.getElementById(\"semesterName\").value = \"\";\r\n      document.getElementById(\"startDate\").value = \"\";\r\n      document.getElementById(\"endDate\").value = \"\";\r\n      document.querySelector(\"#addSemesterModal h3\").textContent = \"Add Semester\";\r\n      saveBtn.textContent = \"Save Semester\";\r\n      semesterModal.style.display = \"block\";\r\n    };\r\n\r\n    semesterClose.onclick = () => (semesterModal.style.display = \"none\");\r\n    window.addEventListener(\"click\", (e) => {\r\n      if (e.target === semesterModal) semesterModal.style.display = \"none\";\r\n    });\r\n\r\n    if (saveBtn) {\r\n      saveBtn.addEventListener(\"click\", async () => {\r\n        const name = document.getElementById(\"semesterName\").value.trim();\r\n        const startDate = document.getElementById(\"startDate\").value;\r\n        const endDate = document.getElementById(\"endDate\").value;\r\n\r\n        const displayStart = startDate ? formatAsLocalDate(startDate) : \"N/A\";\r\n        const displayEnd = endDate ? formatAsLocalDate(endDate) : \"N/A\";\r\n\r\n        if (!name) {\r\n          alert(\"Please enter a semester name.\");\r\n          return;\r\n        }\r\n\r\n        const existingId = editingSemesterCard?.dataset?.semesterId || null;\r\n        const semesterId = await saveSemester({ name, startDate, endDate, semesterId: existingId });\r\n\r\n        if (!semesterId) {\r\n          alert(\"Failed to save semester.\");\r\n          return;\r\n        }\r\n\r\n        const semesterContainer = document.querySelector(\".semester-container\");\r\n\r\n        if (editingSemesterCard) {\r\n          editingSemesterCard.querySelector(\".semester-name\").textContent = name;\r\n          // üîß Remove dropdown state after updating\r\n          editingSemesterCard.classList.remove(\"showing-dropdown\");\r\n          editingSemesterCard.querySelector(\".dropdown-content\")?.classList.remove(\"show\", \"fade-out\");\r\n          editingSemesterCard.querySelector(\".dropbtn\")?.classList.remove(\"active\");\r\n          editingSemesterCard.querySelector(\".semester-dates\").innerHTML = `\r\n            <p>Start: ${displayStart}</p>\r\n            <p>End: ${displayEnd}</p>\r\n          `;\r\n          editingSemesterCard.dataset.semesterId = semesterId;\r\n\r\n          const link = editingSemesterCard.querySelector(\".semester-link\");\r\n          if (link) {\r\n            link.href = `grades.html?semesterId=${semesterId}&semesterName=${encodeURIComponent(name)}&startDate=${encodeURIComponent(displayStart)}&endDate=${encodeURIComponent(displayEnd)}`;\r\n          }\r\n\r\n          editingSemesterCard = null;\r\n        } else {\r\n          const semesterCard = document.createElement(\"div\");\r\n          semesterCard.className = \"semester-card\";\r\n          semesterCard.innerHTML = `\r\n            <div class=\"card-content\">\r\n              <h2 class=\"semester-name\">${name}</h2>\r\n              <div class=\"semester-dates\">\r\n                <p>Start: ${displayStart}</p>\r\n                <p>End: ${displayEnd}</p>\r\n              </div>\r\n              <div class=\"semester-gpa\">GPA: -</div>\r\n              <a class=\"semester-link\" style=\"display:none;\"></a>\r\n            </div>\r\n            <div class=\"dropdown\">\r\n              <button class=\"dropbtn\">...</button>\r\n              <div class=\"dropdown-content\">\r\n                <button class=\"editSemester\" title=\"Edit Semester\">Edit Semester</button>\r\n                <button class=\"deleteSemester\" title=\"Delete Semester\">Delete Semester</button>\r\n              </div>\r\n            </div>\r\n          `;\r\n\r\n          semesterCard.dataset.semesterId = semesterId;\r\n\r\n          const link = semesterCard.querySelector(\".semester-link\");\r\n          if (link) {\r\n            link.href = `grades.html?semesterId=${semesterId}&semesterName=${encodeURIComponent(name)}&startDate=${encodeURIComponent(displayStart)}&endDate=${encodeURIComponent(displayEnd)}`;\r\n          }\r\n\r\n          semesterCard.addEventListener(\"click\", (e) => {\r\n            if (!e.target.closest(\".dropdown\")) {\r\n              semesterCard.querySelector(\".semester-link\")?.click();\r\n            }\r\n          });\r\n\r\n          attachSemesterCardListeners(semesterCard);\r\n          semesterContainer.insertBefore(semesterCard, document.getElementById(\"addSemester\"));\r\n        }\r\n\r\n        semesterModal.style.display = \"none\";\r\n        document.getElementById(\"semesterName\").value = \"\";\r\n        document.getElementById(\"startDate\").value = \"\";\r\n        document.getElementById(\"endDate\").value = \"\";\r\n        editingSemesterCard = null;\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nexport function attachSyllabusButtonListeners(tableElement) {\r\n  const syllabusModal = tableElement.querySelector(\".syllabusModal\");\r\n  const syllabusButton = tableElement.querySelector(\".syllabusButton\");\r\n  const closeModal = tableElement.querySelector(\".syllabusModal .close\");\r\n  const parseSyllabusButton = tableElement.querySelector(\".parseSyllabusButton\");\r\n  const syllabusTextbox = tableElement.querySelector(\".syllabusTextbox\");\r\n\r\n  if (!syllabusButton || !syllabusModal || !closeModal || !parseSyllabusButton || !syllabusTextbox) return;\r\n\r\n  syllabusButton.addEventListener(\"click\", () => {\r\n    syllabusModal.style.display = \"flex\";\r\n  });\r\n\r\n  closeModal.addEventListener(\"click\", () => {\r\n    syllabusModal.style.display = \"none\";\r\n  });\r\n\r\n  window.addEventListener(\"click\", (event) => {\r\n    if (event.target === syllabusModal) syllabusModal.style.display = \"none\";\r\n  });\r\n\r\n  parseSyllabusButton.addEventListener(\"click\", () => {\r\n    const syllabusText = syllabusTextbox.value;\r\n    const table = tableElement.querySelector(\"table\");\r\n    const finalGradeRow = table.querySelector(\"#finalGradeRow\");\r\n\r\n    if (!table || !finalGradeRow) return;\r\n\r\n    const lines = syllabusText.trim().split(\"\\n\");\r\n    const rows = [];\r\n\r\n    let courseCode = \"\";\r\n    let courseTitle = \"\";\r\n    const saveLocalCopyIndex = lines.findIndex((line) => line.includes(\"Save a Local Copy\"));\r\n    if (saveLocalCopyIndex !== -1) {\r\n      courseCode = lines[saveLocalCopyIndex + 1] || \"\";\r\n      courseTitle = lines[saveLocalCopyIndex + 3] || \"\";\r\n    }\r\n\r\n    const courseCodeInput = table.querySelector(\".courseCode\");\r\n    const courseTitleInput = table.querySelector(\".courseTopic\");\r\n\r\n    if (courseCodeInput) courseCodeInput.value = courseCode;\r\n    if (courseTitleInput) courseTitleInput.value = courseTitle;\r\n\r\n    for (const line of lines) {\r\n      const parts = line.trim().split(/\\s{2,}|\\t+/);\r\n      if (parts.length >= 2) {\r\n        const name = parts[0];\r\n        const weight = parseFloat(parts[1]);\r\n        if (!isNaN(weight)) {\r\n          rows.push({ name, weight });\r\n        }\r\n      }\r\n    }\r\n\r\n    const existingRows = table.querySelectorAll(\"tr:not(:first-child, .columnTitles, #finalGradeRow)\");\r\n    existingRows.forEach(row => row.remove());\r\n\r\n    rows.forEach(({ name, weight }) => {\r\n      const newRow = document.createElement(\"tr\");\r\n      newRow.innerHTML = `\r\n        <td><input type=\"text\" value=\"${name}\"></td>\r\n        <td><input type=\"text\" class=\"dueInput\"></td>\r\n        <td><input type=\"number\" class=\"gradeInput\"></td>\r\n        <td><input type=\"number\" class=\"weightInput\" value=\"${weight}\"></td>\r\n        <td><span class=\"lostOutput\">‚Äî</span></td>\r\n        <td class=\"actionsColumn\">\r\n          <button class=\"addRowBtn\" title=\"Add row below\">+</button>\r\n          <button class=\"removeRowBtn\" title=\"Remove selected row\">-</button>\r\n          <button class=\"moveRowBtn\" title=\"Move selected row\">&#9776;</button>\r\n        </td>\r\n      `;\r\n      finalGradeRow.before(newRow);\r\n    });\r\n\r\n    const wrapper = table.closest(\".table-wrapper\");\r\n    attachEventListeners(wrapper);\r\n    calculateFinalGrade(table);\r\n    syllabusModal.style.display = \"none\";\r\n  });\r\n}\r\n\r\nfunction attachSemesterCardListeners(semesterCard) {\r\n  const dropBtn = semesterCard.querySelector(\".dropbtn\");\r\n  const dropdownContent = semesterCard.querySelector(\".dropdown-content\");\r\n\r\n  dropBtn?.addEventListener(\"click\", (e) => {\r\n    e.stopPropagation();\r\n    const isOpen = dropdownContent.classList.contains(\"show\");\r\n    dropdownContent.classList.toggle(\"show\", !isOpen);\r\n    dropdownContent.classList.toggle(\"fade-out\", isOpen);\r\n    semesterCard.classList.toggle(\"showing-dropdown\", !isOpen);\r\n    dropBtn.classList.toggle(\"active\", !isOpen);\r\n  });\r\n\r\n  semesterCard.querySelector(\".editSemester\")?.addEventListener(\"click\", (e) => {\r\n    e.stopPropagation();\r\n    dropdownContent.classList.remove(\"show\");\r\n    dropdownContent.classList.remove(\"fade-out\");\r\n    semesterCard.classList.remove(\"showing-dropdown\");\r\n    dropBtn.classList.remove(\"active\");\r\n    openEditSemesterModal(semesterCard);\r\n  });\r\n\r\n  semesterCard.querySelector(\".deleteSemester\")?.addEventListener(\"click\", (e) => {\r\n    e.stopPropagation();\r\n    if (confirm(\"Are you sure you want to delete this semester?\")) {\r\n      const semesterId = semesterCard.dataset.semesterId;\r\n      if (semesterId) deleteSemester(semesterId);\r\n      semesterCard.remove();\r\n    }\r\n  });\r\n}\r\n\r\nexport function openEditSemesterModal(semesterCard) {\r\n  const name = semesterCard.querySelector(\".semester-name\").textContent;\r\n  const dateTexts = semesterCard.querySelectorAll(\".semester-dates p\");\r\n  const startText = dateTexts[0]?.textContent?.replace(\"Start: \", \"\") ?? \"\";\r\n  const endText = dateTexts[1]?.textContent?.replace(\"End: \", \"\") ?? \"\";\r\n\r\n  document.getElementById(\"semesterName\").value = name;\r\n  document.getElementById(\"startDate\").value = convertToISO(startText);\r\n  document.getElementById(\"endDate\").value = convertToISO(endText);\r\n\r\n  document.querySelector(\"#addSemesterModal h3\").textContent = \"Edit Semester\";\r\n  document.getElementById(\"saveSemester\").textContent = \"Update Semester\";\r\n\r\n  editingSemesterCard = semesterCard;\r\n  document.getElementById(\"addSemesterModal\").style.display = \"block\";\r\n}\r\n\r\nexport { attachSemesterCardListeners };","import { calculateFinalGrade, calculateCurrentGPA } from './gradeCalc.js';\r\nimport { setupMoveRowButton } from './dragDrop.js';\r\nimport { toggleCollapse } from './utils.js';\r\nimport { attachSyllabusButtonListeners } from './modal.js';\r\nimport { saveCourse, saveEvaluation, deleteCourse, clearEvaluations } from './db.js';\r\n\r\n\r\nexport function addRow(event) {\r\n  const clickedButton = event.target;\r\n  const currentRow = clickedButton.closest(\"tr\");\r\n  const table = currentRow.closest(\"table\");\r\n\r\n  const newRow = document.createElement(\"tr\");\r\n  newRow.innerHTML = `\r\n    <td><input type=\"text\"></td>\r\n    <td><input type=\"text\" class=\"dueInput\"></td>\r\n    <td><input type=\"number\" class=\"gradeInput\"></td>\r\n    <td><input type=\"number\" class=\"weightInput\"></td>\r\n    <td><span class=\"lostOutput\">‚Äî</span></td>\r\n    <td class=\"actionsColumn\">\r\n      <button class=\"addRowBtn\" title=\"Add row below\">+</button>\r\n      <button class=\"removeRowBtn\" title=\"Remove selected row\">-</button>\r\n      <button class=\"moveRowBtn\" title=\"Move selected row\">&#9776;</button>\r\n    </td>\r\n  `;\r\n  currentRow.insertAdjacentElement(\"afterend\", newRow);\r\n  attachEventListeners(table.closest(\".table-wrapper\"));\r\n  calculateFinalGrade({ target: table });\r\n}\r\n\r\nexport function removeRow(event) {\r\n  const rowToRemove = event.target.closest(\"tr\");\r\n  const table = rowToRemove.closest(\"table\");\r\n  const totalRows = table.querySelectorAll(\"tr:not(:first-child, #finalGradeRow)\").length;\r\n\r\n  if (totalRows > 1) {\r\n    rowToRemove.remove();\r\n    calculateFinalGrade({ target: table });\r\n  } else {\r\n    alert(\"At least one row must remain.\");\r\n  }\r\n}\r\n\r\nexport function attachEventListeners(wrapper) {\r\n  if (wrapper.dataset.inputListenersAttached !== \"true\") {\r\n    wrapper.dataset.inputListenersAttached = \"true\";\r\n  \r\n    const table = wrapper.querySelector(\"table\");\r\n    if (!table) return;\r\n  \r\n    table.querySelectorAll(\".gradeInput, .weightInput\").forEach((input) =>\r\n      input.addEventListener(\"input\", calculateFinalGrade)\r\n    );\r\n  \r\n    table.querySelectorAll(\".addRowBtn\").forEach((btn) =>\r\n      btn.addEventListener(\"click\", addRow)\r\n    );\r\n  \r\n    table.querySelectorAll(\".removeRowBtn\").forEach((btn) =>\r\n      btn.addEventListener(\"click\", removeRow)\r\n    );\r\n  \r\n    table.querySelectorAll(\".moveRowBtn\").forEach((btn) =>\r\n      setupMoveRowButton(btn)\r\n    );\r\n  \r\n    const collapseBtn = wrapper.querySelector(\".fullScreen\");\r\n    if (collapseBtn) {\r\n      collapseBtn.addEventListener(\"click\", toggleCollapse);\r\n    }\r\n  \r\n    attachSyllabusButtonListeners(wrapper);\r\n  }\r\n  \r\n\r\n  const table = wrapper.querySelector(\"table\");\r\n  if (!table) return;\r\n\r\n  table.querySelectorAll(\".gradeInput, .weightInput\").forEach((input) =>\r\n    input.addEventListener(\"input\", calculateFinalGrade)\r\n  );\r\n\r\n  table.querySelectorAll(\".addRowBtn\").forEach((btn) =>\r\n    btn.addEventListener(\"click\", addRow)\r\n  );\r\n\r\n  table.querySelectorAll(\".removeRowBtn\").forEach((btn) =>\r\n    btn.addEventListener(\"click\", removeRow)\r\n  );\r\n\r\n  table.querySelectorAll(\".moveRowBtn\").forEach((btn) =>\r\n    setupMoveRowButton(btn)\r\n  );\r\n\r\n  // üëá All this moved inside the same listener gate\r\n  const semesterId = new URLSearchParams(window.location.search).get(\"semesterId\");\r\n\r\n  if (semesterId) {\r\n    const courseId = wrapper.dataset.courseId;\r\n    if (courseId) {\r\n      const saveEval = (input) => {\r\n        const row = input.closest(\"tr\");\r\n        const name = row.querySelector(\"td:nth-child(1) input\")?.value.trim();\r\n        const due = row.querySelector(\".dueInput\")?.value.trim();\r\n        const grade = row.querySelector(\".gradeInput\")?.value.trim();\r\n        const weight = row.querySelector(\".weightInput\")?.value.trim();\r\n        const index = [...wrapper.querySelectorAll(\"tr:not(:first-child):not(.columnTitles):not(#finalGradeRow)\")].indexOf(row);\r\n\r\n        console.log(\"üíæ Auto-saving evaluation:\", { name, due, grade, weight, index });\r\n        saveEvaluation({ semesterId, courseId, name, due, grade, weight, index });\r\n        \r\n      };\r\n\r\n      wrapper.querySelectorAll(\".dueInput, .gradeInput, .weightInput, td:nth-child(1) input\").forEach((input) => {\r\n        input.addEventListener(\"blur\", () => saveEval(input));\r\n      });\r\n    } else {\r\n      // Wait for courseId to appear, then attach once\r\n      const observer = new MutationObserver(() => {\r\n        if (wrapper.dataset.courseId) {\r\n          observer.disconnect();\r\n          attachEventListeners(wrapper); // try again, safely\r\n        }\r\n      });\r\n      observer.observe(wrapper, { attributes: true, attributeFilter: [\"data-course-id\"] });\r\n    }\r\n  }\r\n\r\n  const collapseBtn = wrapper.querySelector(\".fullScreen\");\r\n  if (collapseBtn) {\r\n    collapseBtn.addEventListener(\"click\", toggleCollapse);\r\n  }\r\n\r\n  attachSyllabusButtonListeners(wrapper);\r\n}\r\n\r\n\r\nexport function attachAllEventListeners() {\r\n  document.querySelectorAll(\".table-wrapper\").forEach((wrapper) => {\r\n    attachEventListeners(wrapper);\r\n  });\r\n}\r\n\r\nexport function createNewTable(evaluations = [], useExistingTable = false) {\r\n  let newTable;\r\n\r\n  if (useExistingTable) {\r\n    // ‚úÖ Reuse the existing table from HTML\r\n    newTable = document.querySelector(\".table-wrapper\");\r\n  } else {\r\n    // ‚úÖ Create a new table wrapper\r\n    const lastTable = document.querySelector(\".table-wrapper:last-of-type\");\r\n    newTable = document.createElement(\"div\");\r\n    newTable.classList.add(\"table-wrapper\");\r\n    \r\n\r\n    newTable.innerHTML = `\r\n      <table>\r\n        <tr>\r\n          <td colspan=\"6\" class=\"courseHeader\">\r\n            <div class=\"courseContainer\">\r\n              <div class=\"titleBox\">\r\n                <input type=\"text\" placeholder=\"Insert Course Code\" class=\"courseCode\">\r\n                <button class=\"deleteButton\" title=\"Delete Table\">üóëÔ∏è</button>\r\n                <button class=\"fullScreen\" title=\"Collapse Table\">‚Üê</button>\r\n                <input type=\"text\" placeholder=\"Insert Course Topic\" class=\"courseTopic\">\r\n                <button class=\"syllabusButton\" title=\"Parse Syllabus\">üìÑ</button>\r\n                <div class=\"syllabusModal modal\">\r\n                  <div class=\"modal-content\">\r\n                    <span class=\"close\">&times;</span>\r\n                    <textarea class=\"syllabusTextbox\" placeholder=\"Paste the course syllabus here...\"></textarea>\r\n                    <button class=\"parseSyllabusButton\">Parse Syllabus</button>\r\n                    <p class=\"syllabusNote\">Note: Syllabus parsing is not always 100% accurate. Please double check all values match the syllabus.</p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </td>\r\n        </tr>\r\n        <tr class=\"columnTitles\">\r\n          <th>Evaluation</th>\r\n          <th class=\"collapse-hide\">Due</th>\r\n          <th>Mark</th>\r\n          <th class=\"collapse-hide\">Weight</th>\r\n          <th class=\"collapse-hide\">Lost</th>\r\n          <th class=\"collapse-hide\">Actions</th>\r\n        </tr>\r\n        <tr id=\"finalGradeRow\">\r\n          <td colspan=\"2\" style=\"font-weight: bold; text-align: left; background-color: var(--final-grade-bg); color: black; padding: 14px;\">\r\n            Current Mark:\r\n          </td>\r\n          <td colspan=\"2\" class=\"finalGrade\" style=\"font-weight: bold; text-align: left; background-color: var(--final-grade-bg); color: black; padding: 14px;\">\r\n            0.00%\r\n          </td>\r\n          <td colspan=\"2\" style=\"text-align: right; background-color: var(--final-grade-bg); padding: 14px;\">\r\n            [<select class=\"courseUnitsDropdown\">\r\n              <option value=\"0.25\">0.25 units</option>\r\n              <option value=\"0.50\" selected>0.50 units</option>\r\n              <option value=\"0.75\">0.75 units</option>\r\n              <option value=\"1.00\">1.00 units</option>\r\n              <option value=\"1.50\">1.50 units</option>\r\n              <option value=\"2.00\">2.00 units</option>\r\n            </select>]\r\n          </td>\r\n        </tr>\r\n      </table>\r\n    `;\r\n\r\n    if (lastTable) {\r\n      lastTable.insertAdjacentElement(\"afterend\", newTable);\r\n    } else {\r\n      document.querySelector(\".table-container\").appendChild(newTable);\r\n    }\r\n  }\r\n\r\n  const table = newTable.querySelector(\"table\");\r\n  const finalRow = table.querySelector(\"#finalGradeRow\");\r\n\r\n  // üîÑ Remove any existing rows before #finalGradeRow\r\n  const staticRows = table.querySelectorAll(\"tr:not(.columnTitles):not(:first-child):not(#finalGradeRow)\");\r\n  staticRows.forEach((row) => {\r\n    if (row !== finalRow) row.remove();\r\n  });\r\n\r\n  if (evaluations.length > 0) {\r\n    evaluations.forEach((evalData, index) => {\r\n      const { name = \"\", due = \"\", grade = \"\", weight = \"\" } = evalData;\r\n      const row = document.createElement(\"tr\");\r\n      row.innerHTML = `\r\n        <td><input type=\"text\" value=\"${name}\" placeholder=\"Evaluation ${index + 1}\"></td>\r\n        <td><input type=\"text\" class=\"dueInput\" value=\"${due}\"></td>\r\n        <td><input type=\"text\" class=\"gradeInput\" value=\"${grade}\"></td>\r\n        <td><input type=\"text\" class=\"weightInput\" value=\"${weight}\"></td>\r\n        <td><span class=\"lostOutput\">‚Äî</span></td>\r\n        <td class=\"actionsColumn\">\r\n          <button class=\"addRowBtn\" title=\"Add row below\">+</button>\r\n          <button class=\"removeRowBtn\" title=\"Remove selected row\">-</button>\r\n          <button class=\"moveRowBtn\" title=\"Move selected row\">&#9776;</button>\r\n        </td>\r\n      `;\r\n      finalRow.before(row);\r\n    });\r\n  } else {\r\n    for (let i = 0; i < 3; i++) {\r\n      const row = document.createElement(\"tr\");\r\n      row.innerHTML = `\r\n        <td><input type=\"text\" placeholder=\"Evaluation ${i + 1}\"></td>\r\n        <td><input type=\"text\" class=\"dueInput\"></td>\r\n        <td><input type=\"text\" class=\"gradeInput\"></td>\r\n        <td><input type=\"text\" class=\"weightInput\"></td>\r\n        <td><span class=\"lostOutput\">‚Äî</span></td>\r\n        <td class=\"actionsColumn\">\r\n          <button class=\"addRowBtn\" title=\"Add row below\">+</button>\r\n          <button class=\"removeRowBtn\" title=\"Remove selected row\">-</button>\r\n          <button class=\"moveRowBtn\" title=\"Move selected row\">&#9776;</button>\r\n        </td>\r\n      `;\r\n      finalRow.before(row);\r\n    }\r\n  }\r\n\r\n  // ‚úÖ Delete button\r\n  const deleteBtn = newTable.querySelector(\".deleteButton\");\r\n  if (deleteBtn) {\r\n    deleteBtn.addEventListener(\"click\", () => {\r\n      if (confirm(\"Are you sure you want to delete this table?\")) {\r\n        const semesterId = new URLSearchParams(window.location.search).get(\"semesterId\");\r\n        const courseId = newTable.dataset.courseId;\r\n\r\n        if (semesterId && courseId) {\r\n          deleteCourse(semesterId, courseId);\r\n        }\r\n        newTable.remove();\r\n      }\r\n    });\r\n  }\r\n\r\n  const semesterId = new URLSearchParams(window.location.search).get(\"semesterId\");\r\n  const unitsDropdown = newTable.querySelector(\".courseUnitsDropdown\");\r\n  const codeInput = newTable.querySelector(\".courseCode\");\r\n  const topicInput = newTable.querySelector(\".courseTopic\");\r\n\r\n  attachEventListeners(newTable);\r\n\r\n  if (semesterId && codeInput && topicInput && unitsDropdown) {\r\n    let courseSaved = false;\r\n\r\n    const triggerSaveCourse = async () => {\r\n      if (courseSaved) return;\r\n\r\n      const code = codeInput.value.trim();\r\n      const topic = topicInput.value.trim();\r\n      const units = parseFloat(unitsDropdown.value);\r\n\r\n      if (code && !isNaN(units)) {\r\n        const courseId = await saveCourse({ semesterId, code, topic, units });\r\n        if (!courseId) return;\r\n\r\n        newTable.dataset.courseId = courseId;\r\n        courseSaved = true;\r\n\r\n        await clearEvaluations(semesterId, courseId);\r\n\r\n        const rows = newTable.querySelectorAll(\"tr:not(:first-child):not(.columnTitles):not(#finalGradeRow)\");\r\n        for (const [index, row] of [...rows].entries()) {\r\n          const name = row.querySelector(\"td:nth-child(1) input\")?.value.trim();\r\n          const due = row.querySelector(\"td:nth-child(2) input\")?.value.trim();\r\n          const grade = row.querySelector(\"td:nth-child(3) input\")?.value.trim();\r\n          const weight = row.querySelector(\"td:nth-child(4) input\")?.value.trim();\r\n\r\n            await saveEvaluation({ semesterId, courseId, name, due, grade, weight, index });\r\n        }\r\n      }\r\n    };\r\n\r\n    [codeInput, topicInput, unitsDropdown].forEach((el) =>\r\n      el.addEventListener(\"blur\", triggerSaveCourse)\r\n    );\r\n  }\r\n\r\n  return newTable;\r\n}\r\n\r\n\r\n","import { attachAllEventListeners, createNewTable } from './tableOps.js';\r\nimport { setupThemeSelector } from './theme.js';\r\nimport { setupSettingsModal, setupSemesterModal } from './modal.js';\r\nimport { toggleNav } from './utils.js';\r\nimport { loadSemesters } from \"./db.js\";\r\nimport { deleteSemester } from './db.js'; // Add this at the top of the file\r\nimport { openEditSemesterModal } from './modal.js';\r\n\r\n// üîß Attach dropdown/edit/delete functionality to a semester card\r\nfunction attachSemesterCardListeners(semesterCard) {\r\n  const dropBtn = semesterCard.querySelector(\".dropbtn\");\r\n  const dropdownContent = semesterCard.querySelector(\".dropdown-content\");\r\n\r\n  dropBtn?.addEventListener(\"click\", (e) => {\r\n    e.stopPropagation();\r\n    const isOpen = dropdownContent.classList.contains(\"show\");\r\n    dropdownContent.classList.toggle(\"show\", !isOpen);\r\n    dropdownContent.classList.toggle(\"fade-out\", isOpen);\r\n    semesterCard.classList.toggle(\"showing-dropdown\", !isOpen);\r\n    dropBtn.classList.toggle(\"active\", !isOpen);\r\n  });\r\n\r\n  semesterCard.querySelector(\".editSemester\")?.addEventListener(\"click\", (e) => {\r\n    e.stopPropagation();\r\n    openEditSemesterModal(semesterCard);\r\n  });\r\n  \r\n\r\n  semesterCard.querySelector(\".deleteSemester\")?.addEventListener(\"click\", (e) => {\r\n    e.stopPropagation();\r\n    const semesterId = semesterCard.dataset.semesterId;\r\n  \r\n    if (confirm(\"Are you sure you want to delete this semester?\")) {\r\n      if (semesterId) deleteSemester(semesterId); // ‚úÖ Firestore delete\r\n      semesterCard.remove(); // üëã remove from DOM\r\n    }\r\n  });\r\n}\r\n\r\n// üîÅ Recreate saved semesters from Firestore\r\nexport async function initializeSavedSemesters() {\r\n  const semesters = await loadSemesters();\r\n  const semesterContainer = document.querySelector(\".semester-container\");\r\n  const addSemesterBtn = document.getElementById(\"addSemester\");\r\n\r\n  semesters.forEach((semester) => {\r\n    const { id: semesterId, name, startDate, endDate } = semester;\r\n\r\n    const displayStart = startDate ? new Date(startDate).toLocaleDateString() : \"N/A\";\r\n    const displayEnd = endDate ? new Date(endDate).toLocaleDateString() : \"N/A\";\r\n    const queryString = `?semesterId=${semesterId}&semesterName=${encodeURIComponent(name)}&startDate=${encodeURIComponent(displayStart)}&endDate=${encodeURIComponent(displayEnd)}`;\r\n\r\n    const semesterCard = document.createElement(\"div\");\r\n    semesterCard.className = \"semester-card\";\r\n    semesterCard.innerHTML = `\r\n      <div class=\"card-content\">\r\n        <h2 class=\"semester-name\">${name}</h2>\r\n        <div class=\"semester-dates\">\r\n          <p>Start: ${displayStart}</p>\r\n          <p>End: ${displayEnd}</p>\r\n        </div>\r\n        <div class=\"semester-gpa\">GPA: -</div>\r\n        <a href=\"grades.html?semesterId=${semesterId}&semesterName=${encodeURIComponent(name)}&startDate=${encodeURIComponent(displayStart)}&endDate=${encodeURIComponent(displayEnd)}\" class=\"semester-link\" style=\"display:none;\"></a>\r\n      </div>\r\n      <div class=\"dropdown\">\r\n        <button class=\"dropbtn\">...</button>\r\n        <div class=\"dropdown-content\">\r\n          <button class=\"editSemester\" title=\"Edit Semester\">Edit Semester</button>\r\n          <button class=\"deleteSemester\" title=\"Delete Semester\">Delete Semester</button>\r\n        </div>\r\n      </div>\r\n    `;\r\n    semesterCard.dataset.semesterId = semester.id;\r\n\r\n\r\n        if (semesterContainer && addSemesterBtn) {\r\n      semesterContainer.insertBefore(semesterCard, addSemesterBtn);\r\n    } else {\r\n      console.warn(\"üö® Missing container or button:\", { semesterContainer, addSemesterBtn });\r\n    }\r\n\r\n    semesterCard.addEventListener(\"click\", (e) => {\r\n      if (!e.target.closest(\".dropdown\")) {\r\n        semesterCard.querySelector(\".semester-link\")?.click();\r\n      }\r\n    });\r\n\r\n    attachSemesterCardListeners(semesterCard); // ‚úÖ attach dropdown/edit/delete logic\r\n    semesterContainer.insertBefore(semesterCard, addSemesterBtn);\r\n  });\r\n}\r\n\r\n// üì¶ Setup everything once DOM is ready\r\ndocument.addEventListener(\"DOMContentLoaded\", () => {\r\n  setupSettingsModal();\r\n  setupSemesterModal();\r\n  setupThemeSelector();\r\n  attachAllEventListeners();\r\n\r\n  const menuIcon = document.getElementById(\"menuIcon\");\r\n  if (menuIcon) {\r\n    menuIcon.addEventListener(\"click\", toggleNav);\r\n  }\r\n\r\n  const originalDeleteBtn = document.querySelector(\".table-wrapper .deleteButton\");\r\n  if (originalDeleteBtn) {\r\n    originalDeleteBtn.addEventListener(\"click\", () => {\r\n      const wrapper = originalDeleteBtn.closest(\".table-wrapper\");\r\n      if (wrapper && confirm(\"Are you sure you want to delete this table?\")) {\r\n        wrapper.remove();\r\n      }\r\n    });\r\n  }\r\n\r\n  const addTableBtn = document.getElementById(\"addTable\");\r\n  if (addTableBtn) {\r\n    addTableBtn.addEventListener(\"click\", () => {\r\n      createNewTable(); // this function handles all the logic internally\r\n    });\r\n  }\r\n\r\n  // Input auto-width for page title\r\n  const pageTitle = document.getElementById(\"page-title\");\r\n  if (pageTitle) {\r\n    function resizeInput() {\r\n      const span = document.createElement(\"span\");\r\n      span.style.visibility = \"hidden\";\r\n      span.style.position = \"absolute\";\r\n      span.style.whiteSpace = \"nowrap\";\r\n      span.style.font = getComputedStyle(pageTitle).font;\r\n      span.style.padding = getComputedStyle(pageTitle).padding;\r\n      span.textContent = pageTitle.value || pageTitle.placeholder || \"\";\r\n      document.body.appendChild(span);\r\n\r\n      const width = span.offsetWidth + 20;\r\n      pageTitle.style.width = `${width}px`;\r\n\r\n      document.body.removeChild(span);\r\n    }\r\n\r\n    pageTitle.addEventListener(\"input\", resizeInput);\r\n    resizeInput();\r\n  }\r\n});\r\n","export function setupThemeSelector() {\r\n    const themes = {\r\n      default: {\r\n        \"--bg-image\": \"url('../assets/backgrounds/default_background.png')\",\r\n        \"--bg-color\": \"#ffffff\",\r\n        \"--text-color\": \"#000000\",\r\n        \"--button-bg-color\": \"#A3CEF1\",\r\n        \"--table-header-bg\": \"#A3CEF1\",\r\n        \"--table-row-alt-bg\": \"#f5f5f5\",\r\n        \"--final-grade-bg\": \"#A3CEF1\",\r\n      },\r\n      waterloo: {\r\n        \"--bg-image\": \"url('../assets/backgrounds/waterloo_background.png')\",\r\n        \"--bg-color\": \"#ffffff\",\r\n        \"--text-color\": \"#000000\",\r\n        \"--button-bg-color\": \"#fed34c\",\r\n        \"--table-header-bg\": \"#fed34c\",\r\n        \"--table-row-alt-bg\": \"#e5e5e5\",\r\n        \"--final-grade-bg\": \"#fff9c4\",\r\n      },\r\n      pastel: {\r\n        \"--bg-image\": \"url('../assets/backgrounds/purple_background.png')\",\r\n        \"--bg-color\": \"#fef6ff\",\r\n        \"--text-color\": \"#3e3e3e\",\r\n        \"--button-bg-color\": \"#ffc1cc\",\r\n        \"--table-header-bg\": \"#d8bfd8\",\r\n        \"--table-row-alt-bg\": \"#fdf1f9\",\r\n        \"--final-grade-bg\": \"#e0bbff\",\r\n      },\r\n      forest: {\r\n        \"--bg-image\": \"url('../assets/backgrounds/forest.png')\",\r\n        \"--bg-color\": \"#f0f5f1\",\r\n        \"--text-color\": \"#2e3d30\",\r\n        \"--button-bg-color\": \"#81c784\",\r\n        \"--table-header-bg\": \"#a5d6a7\",\r\n        \"--table-row-alt-bg\": \"#e8f5e9\",\r\n        \"--final-grade-bg\": \"#c8e6c9\",\r\n      },\r\n      purple: {\r\n        \"--bg-image\": \"url('../assets/backgrounds/purple_background.png')\",\r\n        \"--bg-color\": \"#ffffff\",\r\n        \"--text-color\": \"#000000\",\r\n        \"--button-bg-color\": \"#c77dff\",\r\n        \"--table-header-bg\": \"#9d4edd\",\r\n        \"--table-row-alt-bg\": \"#f2ebfb\",\r\n        \"--final-grade-bg\": \"#9d4edd\"\r\n      }\r\n    };\r\n  \r\n    const themeSelector = document.getElementById(\"themeSelector\");\r\n    if (themeSelector) {\r\n      themeSelector.addEventListener(\"change\", (e) => {\r\n        const theme = themes[e.target.value];\r\n        for (let variable in theme) {\r\n          document.documentElement.style.setProperty(variable, theme[variable]);\r\n        }\r\n      });\r\n    }\r\n  }\r\n  ","import {\r\n  GoogleAuthProvider,\r\n  signInWithPopup,\r\n  signOut,\r\n  onAuthStateChanged,\r\n  setPersistence,\r\n  browserLocalPersistence\r\n} from \"https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js\";\r\n\r\nimport { auth } from \"./firebase.js\";\r\nimport { initializeSavedSemesters } from \"./main.js\"; // ‚úÖ Load semesters after login\r\n\r\nconst provider = new GoogleAuthProvider();\r\n\r\n// --- Google Sign-In ---\r\nexport function loginWithGoogle() {\r\n  setPersistence(auth, browserLocalPersistence)\r\n    .then(() => signInWithPopup(auth, provider))\r\n    .then((result) => {\r\n      const user = result.user;\r\n      console.log(\"‚úÖ Logged in as:\", user.displayName, user.uid, user.email);\r\n\r\n      const loginBtn = document.getElementById(\"loginBtn\");\r\n      const userDropdownContainer = document.getElementById(\"userDropdownContainer\");\r\n      const userNameDisplay = document.getElementById(\"userNameDisplay\");\r\n\r\n      if (loginBtn) loginBtn.classList.add(\"hidden\");\r\n      if (userDropdownContainer && userNameDisplay) {\r\n        userNameDisplay.textContent = (user.displayName || \"Account\") + \" ‚ñº\";\r\n        userDropdownContainer.classList.remove(\"hidden\");\r\n      }\r\n\r\n      // ‚úÖ Load saved semesters into the UI\r\n      if (window.location.pathname.includes(\"index.html\")) {\r\n        initializeSavedSemesters();\r\n      }\r\n          })\r\n    .catch((error) => {\r\n      console.error(\"‚ùå Login error:\", error.message);\r\n    });\r\n}\r\n\r\n// --- Auth & UI Events ---\r\ndocument.addEventListener(\"DOMContentLoaded\", () => {\r\n  const loginBtn = document.getElementById(\"loginBtn\");\r\n  const userDropdownContainer = document.getElementById(\"userDropdownContainer\");\r\n  const userNameDisplay = document.getElementById(\"userNameDisplay\");\r\n  const dropdownMenu = document.getElementById(\"dropdownMenu\");\r\n  const signOutBtn = document.getElementById(\"signOutBtn\");\r\n\r\n  if (loginBtn) loginBtn.addEventListener(\"click\", loginWithGoogle);\r\n  userNameDisplay?.addEventListener(\"click\", () => dropdownMenu?.classList.toggle(\"hidden\"));\r\n\r\n  signOutBtn?.addEventListener(\"click\", () => {\r\n    signOut(auth)\r\n      .then(() => {\r\n        console.log(\"‚úÖ Logged out\");\r\n        userDropdownContainer.classList.add(\"hidden\");\r\n        dropdownMenu.classList.add(\"hidden\");\r\n        if (loginBtn) loginBtn.classList.remove(\"hidden\");\r\n      })\r\n      .catch((error) => {\r\n        console.error(\"‚ùå Logout error:\", error.message);\r\n      });\r\n  });\r\n\r\n  // --- Persist Auth State UI ---\r\n  onAuthStateChanged(auth, (user) => {\r\n    if (user) {\r\n      console.log(\"‚úÖ User still logged in:\", user.displayName);\r\n      if (userNameDisplay) userNameDisplay.textContent = (user.displayName || \"Account\") + \" ‚ñº\";\r\n      if (userDropdownContainer) userDropdownContainer.classList.remove(\"hidden\");\r\n      if (loginBtn) loginBtn.style.display = \"none\";\r\n      if (window.location.pathname.includes(\"index.html\")) {\r\n        initializeSavedSemesters();\r\n      }\r\n          } else {\r\n      console.log(\"‚ùå User not logged in\");\r\n      if (loginBtn) loginBtn.style.display = \"flex\";\r\n      if (userDropdownContainer) userDropdownContainer.classList.add(\"hidden\");\r\n    }\r\n  });\r\n});\r\n\r\n// Optional global\r\nwindow.loginWithGoogle = loginWithGoogle;\r\n"],"names":["async","semesterId","user","auth","currentUser","courses","courseSnap","getDocs","collection","db","uid","courseDoc","docs","courseId","id","courseData","data","evalSnap","seen","Set","evaluations","map","d","filter","e","key","index","name","due","grade","weight","has","add","sort","a","b","push","window","errorHandler","constructor","this","setupGlobalErrorHandling","setupUnhandledRejections","addEventListener","event","console","error","showUserFriendlyError","reason","preventDefault","message","type","existingNotification","document","getElementById","remove","notification","createElement","innerHTML","backgroundColor","style","cssText","textContent","head","appendChild","body","setTimeout","parentElement","handleFirebaseError","context","userMessage","code","handleValidationError","field","input","querySelector","borderColor","focus","once","showSuccess","missingVars","__vite_import_meta_env__","varName","length","firebaseConfig","apiKey","undefined","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","app","exports","initializeApp","getAuth","getFirestore","log","calculateFinalGrade","table","target","closest","rows","querySelectorAll","totalWeightedScore","totalWeight","validInput","forEach","row","gradeInput","weightInput","lostOutput","parseFloat","value","isNaN","lostValue","innerText","toFixed","color","finalGradeCell","finalGrade","tables","weightedGradeSum","totalUnits","unitsDropdown","units","average","calculateCurrentGPA","isAllowedRow","classList","contains","getAllowedSibling","direction","sibling","previousElementSibling","nextElementSibling","setupMoveRowButton","button","isDragging","draggedRow","initialY","clientY","tbody","parentNode","Array","from","indexOf","toggleNav","sidenav","menuIcon","getComputedStyle","width","toggleCollapse","collapseButton","tableWrapper","deleteButton","finalGradeRow","finalMarkLabel","children","finalMarkValue","unitsCell","isCollapsed","toggle","display","syllabusButton","courseUnitsDropdown","setAttribute","saveEvaluation","evaluationRef","evaluationData","createdAt","serverTimestamp","addDoc","deleteSemester","coursesRef","courseSnapshot","evalsRef","evalSnapshot","evalDoc","deleteDoc","ref","doc","err","warn","deltaY","transform","prevRow","nextRow","rect","getBoundingClientRect","top","height","requestAnimationFrame","insertBefore","editingSemesterCard","convertToISO","dateStr","parsed","Date","toISOString","split","formatAsLocalDate","inputDateStr","year","month","day","parseInt","setupSemesterModal","semesterModal","semesterBtn","semesterClose","saveBtn","onclick","trim","startDate","endDate","displayStart","displayEnd","alert","existingId","dataset","semesterRef","setDoc","saveSemester","semesterContainer","link","href","encodeURIComponent","semesterCard","className","click","dropBtn","dropdownContent","stopPropagation","isOpen","openEditSemesterModal","confirm","attachSemesterCardListeners","attachSyllabusButtonListeners","tableElement","syllabusModal","closeModal","parseSyllabusButton","syllabusTextbox","syllabusText","lines","courseCode","courseTitle","saveLocalCopyIndex","findIndex","line","includes","courseCodeInput","courseTitleInput","parts","newRow","before","attachEventListeners","dateTexts","startText","replace","endText","addRow","currentRow","insertAdjacentElement","removeRow","rowToRemove","wrapper","inputListenersAttached","btn","collapseBtn","URLSearchParams","location","search","get","saveEval","observer","MutationObserver","disconnect","observe","attributes","attributeFilter","createNewTable","useExistingTable","newTable","lastTable","finalRow","evalData","i","deleteBtn","deleteCourse","codeInput","topicInput","courseSaved","triggerSaveCourse","topic","courseRef","saveCourse","deletions","Promise","all","clearEvaluations","entries","el","initializeSavedSemesters","semesters","querySnapshot","firestoreCollection","loadSemesters","addSemesterBtn","semester","toLocaleDateString","settingsModal","settingsBtn","settingsClose","setupSettingsModal","themes","default","waterloo","pastel","forest","purple","themeSelector","theme","variable","documentElement","setProperty","setupThemeSelector","originalDeleteBtn","addTableBtn","pageTitle","resizeInput","span","visibility","position","whiteSpace","font","padding","placeholder","offsetWidth","removeChild","provider","GoogleAuthProvider","loginWithGoogle","setPersistence","browserLocalPersistence","then","signInWithPopup","result","displayName","email","loginBtn","userDropdownContainer","userNameDisplay","pathname","catch","dropdownMenu","signOutBtn","signOut","onAuthStateChanged"],"mappings":"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"}